@model IEnumerable<MasterDetailApp.Models.Order>

@{
    ViewBag.Title = "Orders";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-dark">Orders</h2>
    @Html.ActionLink("Create New Order", "Create", null, new { @class = "btn btn-success" })
</div>

<table class="table table-bordered table-striped table-hover align-middle shadow-sm">
    <thead class="table-dark">
        <tr>
            <th>Customer</th>
            <th>Date</th>
            <th>Paid</th>
            <th>Image</th>
            <th class="text-center">Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr data-id="@item.Id">
                <td>@item.CustomerName</td>
                <td>@item.OrderDate.ToString("yyyy-MM-dd")</td>
                <td>@(item.IsPaid ? "Yes" : "No")</td>
                <td>
                    @if (!string.IsNullOrEmpty(item.ImagePath))
                    {
                        <img src="@Url.Content(item.ImagePath)" class="img-thumbnail" style="width: 60px;" alt="Order Image" />
                    }
                    else
                    {
                        <span class="text-muted">N/A</span>
                    }
                </td>
                <td class="text-center">
                    <button class="btn btn-sm btn-info view-details me-1">🔍 View</button>
                    @Html.ActionLink("✏️ Edit", "Edit", new { id = item.Id }, new { @class = "btn btn-sm btn-warning me-1" })
                    @Html.ActionLink("❌ Delete", "Delete", new { id = item.Id }, new { @class = "btn btn-sm btn-danger" })
                </td>
            </tr>
            <tr class="detail-row bg-light" style="display:none;">
                <td colspan="5" id="detail-@item.Id" class="p-3 text-dark fw-normal" style="border-top: none;">
                    <div class="text-muted">Loading item details...</div>
                </td>
            </tr>
        }
    </tbody>
</table>

@section scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $(".view-details").click(function () {
                var row = $(this).closest("tr");
                var id = row.data("id");
                var detailRow = row.next(".detail-row");
                var detailCell = detailRow.find("td");

                if (detailRow.is(":visible")) {
                    detailRow.hide();
                } else {
                    if (detailCell.data("loaded") !== true) {
                        $.get('/Orders/GetItems/' + id, function (data) {
                            detailCell.html(data);
                            detailCell.data("loaded", true);
                        });
                    }
                    detailRow.show();
                }
            });
        });
    </script>
}
